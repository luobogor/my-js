> 慕课网<<Web安全-XSS>>课程笔记

## Web安全之模拟XSS(Cross-site Script 跨站脚本)攻击

- 反射型

发出请求是,XSS代码出现在URL中,作为输入提交到服务器端,服务器端解析后响应,XSS代码随着响应内容一起传回浏览器,最后浏览器解析执行XSS代码。这个过程像一次反射,故叫做反射型XSS。

- 存储型

 存储型XSS和反射型XSS的差别在于,提交的代码会存储在服务器中(例如数据库,内存,文件系统等),下次请求页面是不用再提交XSS代码。

## 防范措施
### 过滤
- 移除用户上传的DOM属性，如onclick,onerror等
- 移除用户上传的style、a,script、iframe节点等

### 校正
- 避免直接对HTML Entity解码
- 使用DOM Parse转换，校正不配对的DOM标签

## 实验注意点
- routes/index.js需要res.set('X-XSS-Protection',0)，否则Chrome浏览器自带脚本拦截，使攻击不生效
- Chrome浏览器无法发送脚本,要用其他浏览器发送脚本

## CSRF 跨站点请求伪造（Cross-site request forgery）
你已经登录了A，浏览器存有了A网站服务器下发的cookie。

你现在登录B网站，B网站中有一个指向A网站服务器的链接引诱你去点击了。（或者 a 标签、link标签、img 标签、script 标签等可跨站点的请求都可以，不一定是点击链接。但这些只能发送 get 请求，如果要发送 post 请求就需要做一个表单，诱导用户点击提交按钮）

如果A网站的服务器只有cookie验证，那么B网站已经拥有你在A网站的访问权限了。

- 防范措施：增加除了cookie以外的其他验证
  - Token验证(url中存放令牌，或者 form input hidden 存在令牌)
  - Http请求头添加Referer验证:如果服务器检测到referer字段不是自己的前端网站，则可以判断到是攻击者
  - 隐藏令牌(请求头中存放令牌)

````
- cookie是储存在浏览器中的一段字符串，它本身是没有任何危害的，不包含任何可执行的代码。
- 储存cookie是浏览器的功能，浏览器的安装目录下会有一个专门存放不同域名下的cookie的文件夹。
- 当网页发起http请求的时候，浏览器首先会检查是否有对应域名的cookie，如果有，就会自动添加到request header中，发送给服务器。
- cookie的存放有大小限制，不可以超过4kb, 每一个域名下的cookie数量最多是20个
````

## 两种攻击的区别
- CSRF利用本身的漏洞来调用接口(骗过登录验证)
